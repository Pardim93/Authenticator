package com.natura.auth.sdk.managers;

import android.app.Application;

import com.facebook.react.NaturaAuthSDKPackageList;
import com.natura.auth.sdk.packages.NaturaAuthSDKPackage;
import com.facebook.react.ReactInstanceManager;
import com.facebook.react.ReactPackage;
import com.facebook.react.common.LifecycleState;

import java.util.ArrayList;
import java.util.List;

public class NaturaAuthSDKInstanceManager {
  private static ReactInstanceManager reactInstanceManager;

  private static final String REACT_BUNDLE_ASSET_NAME = "natura.auth.sdk.android.bundle";
  private static final String REACT_MAIN_MODULE_PATH  = "index";

  public synchronized static ReactInstanceManager getReactInstanceManager(Application application) {
    if(reactInstanceManager == null) {
      reactInstanceManager = createInstanceManager(application);
    }
    return reactInstanceManager;
  }

  private static List<ReactPackage> getPackages(Application application) {
    List<ReactPackage> packageList = new ArrayList<>();

    List<ReactPackage> autoGeneratedPackageList = new NaturaAuthSDKPackageList(application).getPackages();
    packageList.addAll(autoGeneratedPackageList);

    packageList.add(new NaturaAuthSDKPackage(application.getApplicationContext()));
    return packageList;
  }

  private static ReactInstanceManager createInstanceManager(Application application) {
      return ReactInstanceManager.builder()
        .setApplication(application)
        .setBundleAssetName(REACT_BUNDLE_ASSET_NAME)
        .setJSMainModulePath(REACT_MAIN_MODULE_PATH)
        .addPackages(getPackages(application))
        .setUseDeveloperSupport(true)
        .setInitialLifecycleState(LifecycleState.BEFORE_RESUME)
        .build();
    }
}
